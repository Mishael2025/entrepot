<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Document</title>
        <link rel="stylesheet" href="../css/Iventaire.css">
    </head>

    <body>
        <div id="sidebar-container"></div>
        <div class="role-badge" id="role-label"></div>

        <header class="header-top">
     
        </header>

        <section class="section-form">
            <form id="constat-ecart-form" class="card">
                <h2> Constat d‚Äô√©cart en sortie produit</h2>

                <div class="form-group">
                    <label for="filtrer-produits">üîç Filtrer les
                        produits</label>
                    <input type="text" id="filtrer-produits"
                        placeholder="Ex: Riz, Jus...">
                </div>

                <div class="form-group">
                    <label for="produit">Produit :</label>
                    <select id="produit" required>
                        <option value>-- Choisir un produit --</option>
                    </select>
                </div>

                <div class="form-inline">
                    <div>Th√©orique : <span id="quantite-theorique">0</span>
                        kg</div>
                    <div>√âcart : <span id="ecart-affichage">0</span> kg</div>
                </div>

                <div class="form-group">
                    <label for="quantite-reelle">Quantit√© r√©ellement disponible
                        :</label>
                    <input type="number" id="quantite-reelle"
                        placeholder="Ex: 750" required>
                </div>

                <div class="form-group">
                    <label for="justification">Justification :</label>
                    <textarea id="justification"
                        placeholder="Si √©cart ‚â† 0..."></textarea>
                </div>

                <button type="submit" class="btn-primary">‚úÖ Enregistrer le
                    constat</button>
            </form>
        </section>

        <section class="section-table">
            <h3> Historique des constats</h3>
            <table id="historique-inventaire" class="styled-table">
                <thead>
                    <tr>
                        <th>Produit</th>
                        <th>Th√©orique</th>
                        <th>R√©el</th>
                        <th>√âcart</th>
                        <th>Justification</th>
                        <th>Date</th>
                        <th>Utilisateur</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </section>

        <section class="section-form">
            <form id="planification-form" class="card">
                <h3> Planifier une livraison</h3>

                <div class="form-group">
                    <label for="filtrer-produit">üîç Filtrer les produits</label>
                    <input type="text" id="filtrer-produit"
                        placeholder="Ex: Haricots...">
                </div>

                <div class="form-group">
                    <label for="produit-planifie">Produit :</label>
                    <select id="produit-planifie" required></select>
                </div>

                <div class="form-group">
                    <label for="type">Type :</label>
                    <select id="type" name="type"
                        onchange="toggleFournisseur()">
                        <option value="entr√©e">Entr√©e</option>
                        <option value="sortie">Sortie</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="quantite-planifiee">Quantit√© (kg) :</label>
                    <input type="number" id="quantite-planifiee" step="0.01"
                        required>
                </div>

                <div class="form-group">
                    <label for="date-prevue">Date pr√©vue :</label>
                    <input type="datetime-local" id="date-prevue" required>
                </div>

                <div class="form-group">
                    <label for="commentaire">Commentaire :</label>
                    <textarea id="commentaire" rows="2"></textarea>
                </div>

                <div class="form-group" id="fournisseur-block"
                    style="display:none;">
                    <label for="fournisseur-planifie">Fournisseur :</label>
                    <select id="fournisseur-planifie">
                        <option value>-- S√©lectionner --</option>
                    </select>
                </div>

                <button type="submit" class="btn-primary">üìÖ
                    Enregistrer</button>
            </form>
        </section>

        <section class="section-table">
            <h3> Calendrier des planifications</h3>
            <div id="calendrier-planifications"></div>

           

        </section>

        <script src="../js/sessionStorage.js"></script>

        <script src="../js/Iventaire.js"></script>
        <script>



// Trier colonne
function trierTableau(colIndex) {
    const tbody = document.querySelector("#table-planification tbody");
    const rows = Array.from(tbody.querySelectorAll("tr"));

    const sorted = rows.sort((a, b) => {
        const valA = a.children[colIndex].textContent.trim().toLowerCase();
        const valB = b.children[colIndex].textContent.trim().toLowerCase();
        return valA.localeCompare(valB);
    });

    tbody.innerHTML = "";
    sorted.forEach(row => tbody.appendChild(row));
}

           function toggleFournisseur() {
            const type = document.getElementById('type').value;
            document.getElementById('fournisseur-block').style.display = (type === 'entr√©e') ? 'block' : 'none';
        }

        // Place ce code juste apr√®s l'injection du sidebar
        fetch("../html/sidebard.html")
            .then(r => r.text())
            .then(html => {
                const container = document.getElementById("sidebar-container");
                container.innerHTML = html;

                // Attendre que le DOM inject√© soit bien interpr√©t√©
                setTimeout(() => {
                    const logoutBtn = document.getElementById("logout-btn");
                    if (logoutBtn) {
                        logoutBtn.addEventListener("click", () => {
                            sessionStorage.clear();
                            localStorage.clear();
                            window.location.href = "../html/PageConnexion.html";
                        });
                    } else {
                        console.warn("üîç Bouton #logout-btn introuvable dans sidebard.html");
                    }
                }, 50); // ‚Üê Ajustable selon la complexit√© du HTML inject√©
            });

    </script>
    </body>

</html>