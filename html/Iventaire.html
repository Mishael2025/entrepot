<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Document</title>
        <link rel="stylesheet" href="../css/Iventaire.css">
    </head>

    <body>
        <div id="sidebar-container"></div>
        <select class="field-inventaire editable-field"></select>
        <div id="role-label" class="role-badge"></div>

        <form id="constat-ecart-form">
            <h2> Constat d‚Äô√©cart en sortie produit</h2>

            <label for="produit">Produit :</label>
            <input type="text" id="filtrer-produits" placeholder="üîÑFiltrer les produits">
            <select id="produit" required>
                
                <option value>-- Choisir un produit --</option>
                <!-- Options dynamiques -->
            </select>

            <div>Quantit√© th√©orique : <span id="quantite-theorique">0</span>
                kg</div>

            <label for="quantite-observee">Quantit√© r√©ellement disponible:</label>
            <input type="number" id="quantite-reelle" placeholder="Ex: 750"
                required>

            <div id="ecart-affichage">√âcart : 0 kg</div>

            <textarea id="justification"
                placeholder="Justification de l‚Äô√©cart (si √©cart ‚â† 0)"></textarea>

            <button type="submit"> Enregistrer le constat</button>
        </form>

        <table id="historique-inventaire">
            <thead>
                <tr>
                    <th>Produit</th>
                    <th>Th√©orique</th>
                    <th>R√©el</th>
                    <th>√âcart</th>
                    <th>Justification</th>
                    <th>Date</th>
                    <th>Utilisateur</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>

        <form id="planification-form" class="form-planification">
            <h3>üì¶ Planifier une livraison</h3>

            <label for="produit-planifie">Produit :</label>
            <input type="text" id="filtrer-produit" placeholder="üîÑFiltrer les produits">
            <select id="produit-planifie" required>
                <!-- Options dynamiques via JS -->
            </select>

            <label>Type :</label>
            <div class="radiob">
                <select id="type" name="type" onchange="toggleFournisseur()">
                    <option value="entr√©e">Entr√©e</option>
                    <option value="sortie">Sortie</option>
                </select>
            </div>
            <label for="quantite-planifiee">Quantit√© (kg) :</label>
            <input type="number" id="quantite-planifiee" step="0.01" required>

            <label for="date-prevue">Date pr√©vue :</label>
            <input type="datetime-local" id="date-prevue" required>

            <label for="commentaire">Commentaire :</label>
            <textarea id="commentaire" rows="2"></textarea>
            <label for="fournisseur-planifie">Fournisseur :</label>
            <div id="fournisseur-block" style="display:none;">
                <select id="fournisseur-planifie">
                    <option value>-- S√©lectionner --</option>
                    <!-- Options dynamiques via JS -->
                </select>
            </div>
            <button type="submit">üìÖ Enregistrer</button>
        </form>

        <div id="calendrier-planifications"></div>

        <div class="table-wrapper">
            <div class="table-controls">
                <label for="filtre-statut">Filtrer par statut :</label>
                <select id="filtre-statut" onchange="filtrerTableau()">
                    <option value="tous">Tous</option>
                    <option value="confirm√©">Confirm√©</option>
                    <option value="attente">En attente</option>
                    <option value="annul√©">Annul√©</option>
                </select>
            </div>

            <table class="table-planification" id="table-planification">
                <thead>
                    <tr>
                        <th onclick="trierTableau(0)">üìÖ Date</th>
                        <th onclick="trierTableau(1)">üîÅ Type</th>
                        <th onclick="trierTableau(2)">üì¶ Produit</th>
                        <th onclick="trierTableau(3)">‚öñÔ∏è Quantit√©</th>
                        <th>üßæ Statut</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Lignes dynamiques ici -->
                </tbody>
            </table>
        </div>

        <script src="../js/sessionStorage.js"></script>

        <script src="../js/Iventaire.js"></script>
        <script>


//Fonction de filtrage du tableau
function filtrerTableau() {
    const filtre = document.getElementById("filtre-statut").value;
    const tbody = document.querySelector("#table-planification tbody");
    tbody.innerHTML = "";

    const filtr√©es = filtre === "tous"
        ? planifications
        : planifications.filter(p => p.statut === filtre);

    filtr√©es.forEach(p => {
        const row = document.createElement("tr");
        row.innerHTML = `
            <td>${new Date(p.date_prevue).toLocaleString()}</td>
            <td>${p.type}</td>
            <td>${p.produit_nom}</td>
            <td>${p.quantite} kg</td>
            <td>${p.statut}</td>
        `;
        tbody.appendChild(row);
    });
}
// Trier colonne
function trierTableau(colIndex) {
    const tbody = document.querySelector("#table-planification tbody");
    const rows = Array.from(tbody.querySelectorAll("tr"));

    const sorted = rows.sort((a, b) => {
        const valA = a.children[colIndex].textContent.trim().toLowerCase();
        const valB = b.children[colIndex].textContent.trim().toLowerCase();
        return valA.localeCompare(valB);
    });

    tbody.innerHTML = "";
    sorted.forEach(row => tbody.appendChild(row));
}

           function toggleFournisseur() {
            const type = document.getElementById('type').value;
            document.getElementById('fournisseur-block').style.display = (type === 'entr√©e') ? 'block' : 'none';
        }

        // Place ce code juste apr√®s l'injection du sidebar
        fetch("../html/sidebard.html")
            .then(r => r.text())
            .then(html => {
                const container = document.getElementById("sidebar-container");
                container.innerHTML = html;

                // Attendre que le DOM inject√© soit bien interpr√©t√©
                setTimeout(() => {
                    const logoutBtn = document.getElementById("logout-btn");
                    if (logoutBtn) {
                        logoutBtn.addEventListener("click", () => {
                            sessionStorage.clear();
                            localStorage.clear();
                            window.location.href = "../html/PageConnexion.html";
                        });
                    } else {
                        console.warn("üîç Bouton #logout-btn introuvable dans sidebard.html");
                    }
                }, 50); // ‚Üê Ajustable selon la complexit√© du HTML inject√©
            });

    </script>
    </body>

</html>